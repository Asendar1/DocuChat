syntax = "proto3";

package docuchat;

option go_package = "github.com/Asendar1/DocuChat/scrapper/pb";

// Service for document processing, it will handle the processing of files, it will return the number of tokens and if the file was already processed before
service	DocumentProcessor {
	// generic test method to test the connection and the setup of the proto files
	rpc	Test(TestReq) returns (TestRes);

	// method to process a file, it will return the number of tokens and if the file was already processed before
	rpc ProcessFile(FileRequest) returns (ProcessResponse);
}

// Service for vector search operations, it will handle the search, retrieval and deletion of documents based on their hashes
service VectorSearch {

	// method to search for relevant documents based on a query, it will return the top k results with their scores and the time taken for the search
	rpc Search(SearchRequest) returns (SearchResponse);

	// method to retrieve the content of a document based on its hash, it will return the document content and its hash
	rpc GetDocument(HashedFile) returns (Document);

	// method to delete a document based on its hash, it will return a success flag and a message
	rpc DeleteDocument(HashedFile) returns (DeleteResponse);
}

message TestReq {
	string tm = 1;
}

message TestRes {
	string tm = 1;
}

message FileRequest {
	string hash = 1;
	string content = 2;
}

message ProcessResponse {
	bool success = 1;
	bool already_exists = 2;
	string message = 3;
	int32 tokens = 4;
}

message HashedFile {
	string hash = 1;
}

message SearchRequest {
	string query = 1;
	int32 top_k = 2; // number of top results to return (default: 5)
}

message SearchResponse {
	repeated SearchResult results = 1;
	float	query_time_ms = 2;
}

message SearchResult {
	string doc_hash = 1;
	string	content = 2;
	float score = 3;
}

message Document {
	string hash = 1;
	string content = 2;
}

message DeleteResponse {
	bool success = 1;
	string message = 2;
}
